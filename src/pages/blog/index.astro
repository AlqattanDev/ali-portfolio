---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Section from '../../components/Section.astro';

// Fetch all blog posts
const allPosts = await getCollection('blog');

// Sort them from newest to oldest
const sortedPosts = allPosts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout>
    <Header />

    <div class="execute-protocol">
        <p class="terminal-command">$ ./blog --list</p>
        <p class="comment">// Loading system log entries...</p>
        <p>Found {sortedPosts.length} entries</p>
        <p>Main Site: <a href="/">/</a></p>
    </div>

    <Section title="SYSTEM_LOG">
        {sortedPosts.map(post => (
            <div class="entry">
                <div class="entry-header">
                    <a href={`/blog/${post.slug}/`} class="entry-title">{post.data.title}</a>
                    <span class="entry-meta">{post.data.publishDate.toISOString().slice(0,10)}</span>
                </div>
                <p class="entry-description">{post.data.description}</p>
                <div class="tech-stack">
                    {post.data.tags.map(tag => <span class="tech-tag">{tag}</span>)}
                </div>
            </div>
        ))}
    </Section>
</Layout>

